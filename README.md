# Paste Image Inliner - 智能内容处理扩展

## 🎯 功能概述

这是一个功能强大的Chrome扩展，专为解决复制粘贴时的各种内容处理问题而设计。特别适用于钉钉文档、富文本编辑器等场景，提供智能的内容转换和格式优化功能。

## ✨ 核心功能

### 🖼️ 图片内联处理
- **问题解决**: 复制粘贴时图片链接失效，在钉钉等平台显示"图片粘贴失败"
- **解决方案**: 自动将外链图片转换为base64内联格式
- **技术特性**: 绕过CORS限制，支持跨域图片下载

### 📝 智能标题替换
- **功能**: 自动替换HTML标题标签，如h1→h3、h2→h3等
- **特性**: 防级联替换，智能匹配规则
- **配置**: 支持自定义替换规则，可启用/禁用

### 📋 表格标题处理
- **问题**: table caption标签在复制粘贴时经常丢失
- **解决**: 自动将caption转换为独立的文本段落
- **效果**: 确保表格标题正确显示

### 🧹 空行清理
- **功能**: 自动清理多余的空行和空白段落
- **选项**: 可配置清理程度（空段落、空div、多余换行等）
- **效果**: 让内容更加紧凑美观

### 🔗 链接处理
- **功能**: 移除链接并将文字转换为红色文本
- **配置**: 支持自定义红色色值
- **用途**: 保持内容可读性，突出重要文字

### 🚫 页脚过滤
- **功能**: 智能识别并过滤页脚版权信息
- **关键词**: 自动检测"版权所有"、"华为技术有限公司"、"Copyright"等
- **效果**: 避免复制不需要的版权信息

### 🎯 插件元素过滤
- **功能**: Ctrl+A全选时自动过滤插件自身的设置按钮
- **效果**: 确保复制内容的纯净性

### 🎨 格式保持
- **功能**: 完整保持原始HTML格式和样式
- **支持**: 各种富文本编辑器和在线文档平台

## 🚀 快速开始

### 安装方法

1. **下载源码**: 克隆或下载本项目到本地
```bash
git clone https://github.com/lyyancey/paste-image-inliner.git
```

2. **安装扩展**:
   - 打开Chrome浏览器，访问 `chrome://extensions/`
   - 开启右上角"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择项目文件夹

3. **验证安装**: 扩展图标出现在浏览器工具栏中

### 使用方法

#### 基础使用
1. 在任意网页中选择内容（支持Ctrl+A全选）
2. 复制内容（Ctrl+C）
3. 在目标编辑器中粘贴（Ctrl+V）
4. 所有处理步骤自动完成

#### 配置管理
- **快捷键**: `Ctrl+Shift+H` 打开配置面板
- **功能开关**: 可独立启用/禁用各项功能
- **自定义设置**: 支持个性化配置各种参数

#### 测试验证
- 访问各种测试页面验证功能
- 检查扩展状态和配置信息

## 🧪 测试页面

本扩展提供了丰富的测试页面来验证各项功能：

| 测试页面 | 功能验证 | 描述 |
|---------|---------|------|
| `simple-test.html` | 图片内联基础功能 | 测试图片转换为base64 |
| `heading-test.html` | 标题替换功能 | 测试h1→h3、h2→h3等替换 |
| `caption-test.html` | 表格标题处理 | 测试caption转换为独立段落 |
| `empty-line-test.html` | 空行清理功能 | 测试多余空行的清理 |
| `link-test.html` | 链接处理功能 | 测试链接转红色文字 |
| `footer-test.html` | 页脚过滤功能 | 测试版权信息过滤 |
| `select-all-test.html` | 全选过滤功能 | 测试Ctrl+A时的元素过滤 |
| `format-test.html` | 格式保持功能 | 测试复杂格式的保持 |
| `extension-status.html` | 功能状态检查 | 查看所有功能的运行状态 |

### 推荐测试流程
1. **基础验证**: 先测试 `simple-test.html` 确保基本功能正常
2. **功能测试**: 逐一测试各专项功能页面
3. **状态检查**: 使用 `extension-status.html` 查看整体状态
4. **配置调试**: 使用 `Ctrl+Shift+H` 调整各项设置

## 🔧 技术架构

### 核心组件

#### Background Service Worker (`background.js`)
- **CORS绕过**: 处理跨域图片下载请求
- **图片转换**: 将图片转换为base64格式
- **错误处理**: 多重fallback机制确保稳定性

#### Content Script (`content.js`)
- **事件监听**: 监听copy/paste事件
- **内容处理**: 六阶段内容处理流水线
- **配置管理**: 完整的配置系统和UI界面
- **智能过滤**: 多种内容过滤和优化算法

#### 处理流水线
```
原始内容 → 图片内联 → 表格标题转换 → 标题替换 → 
链接处理 → 页脚过滤 → 空行清理 → 插件元素过滤 → 最终内容
```

### 关键技术特性

#### 智能内容识别
- **图片检测**: 支持img标签和CSS背景图片
- **页脚识别**: 基于关键词的智能匹配算法
- **插件元素**: 自动识别和过滤扩展自身元素

#### 配置系统
- **持久化存储**: 使用localStorage保存用户配置
- **实时同步**: 配置变更立即生效
- **模块化管理**: 每个功能独立的配置模块

#### 错误处理
- **多重fallback**: 图片下载失败时的降级策略
- **异常捕获**: 完整的错误日志和恢复机制
- **兼容性保证**: 支持各种浏览器和编辑器环境

## 📁 文件结构

```
paste-image-inliner/
├── manifest.json                 # 扩展配置文件 (Manifest V3)
├── background.js                 # 后台服务工作者
├── content.js                    # 内容脚本 (核心逻辑)
├── README.md                     # 项目文档
├── 
├── 📋 测试页面
├── simple-test.html              # 基础图片内联测试
├── heading-test.html             # 标题替换功能测试
├── caption-test.html             # 表格标题处理测试
├── empty-line-test.html          # 空行清理功能测试
├── link-test.html                # 链接处理功能测试
├── footer-test.html              # 页脚过滤功能测试
├── select-all-test.html          # 全选过滤功能测试
├── format-test.html              # 格式保持功能测试
├── extension-status.html         # 扩展状态检查页面
├── dingtalk-test.html            # 钉钉专用测试页面
├── test.html                     # 综合功能测试页面
├── copy-test.html                # 复制功能专项测试
├── status-check.html             # 快速状态检查
└── debug-tool.html               # 调试工具页面
```

### 核心文件说明

- **`manifest.json`**: Chrome扩展配置，定义权限和入口点
- **`background.js`**: 处理跨域请求和图片下载
- **`content.js`**: 主要逻辑文件，包含所有内容处理功能

### 支持的格式和平台

#### 图片格式支持
- ✅ JPG/JPEG - 标准图片格式
- ✅ PNG - 支持透明背景
- ✅ GIF - 支持动画
- ✅ WebP - 现代图片格式
- ✅ SVG - 矢量图形
- ✅ BMP - 位图格式

#### 平台兼容性
- 🎯 **钉钉文档** - 主要目标平台
- 📝 **富文本编辑器** - TinyMCE、CKEditor等
- 📄 **在线文档平台** - 腾讯文档、石墨文档等
- 📧 **邮件客户端** - Gmail、Outlook网页版
- 🌐 **各种CMS系统** - WordPress、Drupal等

## ⚙️ 配置选项

扩展提供了丰富的配置选项，可通过 `Ctrl+Shift+H` 打开配置面板：

### 🖼️ 图片内联配置
- 始终启用，无需配置
- 自动处理所有图片格式

### 📝 标题替换配置
- **启用开关**: 可开启/关闭标题替换功能
- **替换规则**: 支持自定义h1-h6的替换目标
- **防级联**: 智能防止重复替换

### 🧹 空行清理配置
- **启用开关**: 控制空行清理功能
- **清理选项**:
  - 移除空段落 (`<p></p>`)
  - 移除空div (`<div></div>`)
  - 清理多余换行符
  - 紧凑间距

### 🔗 链接处理配置
- **启用开关**: 控制链接处理功能
- **处理选项**:
  - 移除链接属性
  - 转换为红色文字
  - 自定义红色色值

### 🚫 页脚过滤配置
- **启用开关**: 控制页脚过滤功能
- **过滤关键词**: 可自定义关键词列表
- **默认关键词**: 版权所有、华为技术有限公司、Copyright等

### 💾 配置管理
- **保存配置**: 自动保存所有设置
- **重置配置**: 一键恢复默认设置
- **实时生效**: 配置更改立即生效

## ⌨️ 快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl+Shift+H` | 打开配置面板 | 快速访问所有设置选项 |
| `Ctrl+A` | 智能全选 | 自动过滤插件元素 |
| `Ctrl+C` | 智能复制 | 自动处理所有内容转换 |
| `Ctrl+V` | 增强粘贴 | 在支持的编辑器中增强粘贴体验 |

## 🔍 故障排除

### 常见问题及解决方案

#### 🖼️ 图片相关问题

**问题**: 图片无法转换或显示失败
- ✅ **检查权限**: 确保扩展有"所有网站"访问权限
- ✅ **网络检查**: 验证图片URL是否可正常访问
- ✅ **CORS限制**: 某些网站有防盗链保护，属于正常现象
- ✅ **图片大小**: 超大图片可能转换失败，建议优化图片尺寸

**问题**: 粘贴后图片丢失
- ✅ **编辑器支持**: 确认目标编辑器支持HTML格式粘贴
- ✅ **格式检查**: 验证剪贴板中是否包含正确的HTML内容
- ✅ **测试验证**: 在测试页面中验证功能是否正常

#### ⚙️ 功能相关问题

**问题**: 某些功能不生效
- ✅ **配置检查**: 使用`Ctrl+Shift+H`检查功能是否启用
- ✅ **扩展状态**: 访问`extension-status.html`查看功能状态
- ✅ **浏览器刷新**: 尝试刷新页面重新加载扩展
- ✅ **控制台日志**: 查看浏览器控制台是否有错误信息

**问题**: 配置面板无法打开
- ✅ **快捷键检查**: 确认使用`Ctrl+Shift+H`组合键
- ✅ **扩展重载**: 在chrome://extensions/中重新加载扩展
- ✅ **页面环境**: 在可编辑的页面中尝试打开配置面板

#### 🔧 性能相关问题

**问题**: 处理速度较慢
- ✅ **图片数量**: 大量图片会增加处理时间
- ✅ **网络延迟**: 图片下载需要时间，请耐心等待
- ✅ **内容复杂度**: 复杂HTML结构会影响处理速度

### 调试工具

- **控制台日志**: 扩展会输出详细的处理日志
- **测试页面**: 使用各种测试页面验证功能
- **状态检查**: 通过状态页面监控功能运行状态

## 📋 注意事项

### 使用限制
1. **防盗链保护**: 某些网站的图片有防盗链，无法转换属正常现象
2. **文档大小**: 大量图片转换为base64会增加文档体积
3. **网络依赖**: 图片转换需要网络访问，离线状态下功能受限
4. **编辑器兼容**: 部分编辑器可能不完全支持HTML格式粘贴

### 权限说明
- **所有网站访问**: 用于跨域图片下载和内容处理
- **剪贴板操作**: 用于读取和写入剪贴板内容
- **存储权限**: 用于保存用户配置信息

### 性能建议
- 避免同时处理过多大尺寸图片
- 定期清理浏览器缓存以保持最佳性能
- 在网络状况良好时使用以获得最佳体验

## 📊 版本历史

### v2.0.0 (Current) - 智能内容处理版本
- ✨ **新增**: 页脚过滤功能 - 智能识别并过滤版权信息
- ✨ **新增**: 链接处理功能 - 移除链接转红色文字
- ✨ **新增**: 空行清理功能 - 自动清理多余空行
- ✨ **新增**: 插件元素过滤 - Ctrl+A时过滤扩展自身元素
- ✨ **新增**: 完整配置系统 - 可视化配置面板和快捷键
- ✨ **新增**: 多个专项测试页面和状态检查工具
- 🔧 **改进**: 全面重构内容处理流水线
- 🔧 **改进**: 增强错误处理和fallback机制

### v1.5.0 - 标题处理版本
- ✨ **新增**: 智能标题替换功能 (h1→h3, h2→h3等)
- ✨ **新增**: 表格标题处理 (caption转换)
- ✨ **新增**: 防级联替换算法
- 🔧 **改进**: 配置持久化存储
- 📄 **新增**: 标题和表格测试页面

### v1.0.0 - 基础图片内联版本
- ✨ **核心功能**: 图片内联转换为base64
- ✨ **CORS绕过**: 支持跨域图片下载
- ✨ **多格式支持**: JPG、PNG、GIF、WebP、SVG
- ✨ **编辑器兼容**: 支持钉钉、富文本编辑器等
- 📄 **基础测试**: 提供基本测试页面

## 🤝 贡献指南

### 开发环境设置
1. 克隆项目到本地
2. 在Chrome中加载扩展进行开发
3. 使用测试页面验证功能

### 贡献流程
1. Fork项目
2. 创建功能分支
3. 提交代码和测试
4. 创建Pull Request

### 代码规范
- 使用清晰的变量命名
- 添加详细的注释说明
- 遵循现有的代码风格
- 为新功能添加对应的测试页面

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🔗 相关链接

- **GitHub仓库**: [paste-image-inliner](https://github.com/lyyancey/paste-image-inliner)
- **问题反馈**: [Issues](https://github.com/lyyancey/paste-image-inliner/issues)
- **功能建议**: [Discussions](https://github.com/lyyancey/paste-image-inliner/discussions)

## 🙏 致谢

感谢所有贡献者和用户的支持，让这个项目不断改进和完善！

---

**如果这个扩展对你有帮助，请给项目一个 ⭐ Star！**
